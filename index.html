<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>For ChouChou üíõ</title>

<style>
html,body{
    margin:0;
    padding:0;
    overflow:hidden;
    background:black;
    height:100vh;
    touch-action:manipulation;
    -webkit-tap-highlight-color: transparent;
}
canvas{
    display:block;
    position:fixed;
    top:0;
    left:0;
}
#intro{
    position:fixed;
    inset:0;
    background:radial-gradient(circle at center,#000020,#000);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:999;
    transition:opacity 1s ease;
}
.intro-content{
    text-align:center;
    color:#FFD700;
    animation: glow 2s infinite alternate;
}
@keyframes glow{
    from{text-shadow:0 0 10px #FFD700;}
    to{text-shadow:0 0 25px #FFD700;}
}
</style>
</head>

<body>

<div id="intro">
    <div class="intro-content">
        <h2>‚ú® Ch·∫°m ƒë·ªÉ b·∫Øt ƒë·∫ßu ‚ú®</h2>
        <p>For ChouChou üíõ</p>
    </div>
</div>

<canvas id="canvas"></canvas>
<audio id="bgMusic" src="music.mp3" preload="auto"></audio>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const intro=document.getElementById("intro");
const music=document.getElementById("bgMusic");

function resize(){
    const dpr=window.devicePixelRatio||1;
    canvas.width=innerWidth*dpr;
    canvas.height=innerHeight*dpr;
    canvas.style.width=innerWidth+"px";
    canvas.style.height=innerHeight+"px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
addEventListener("resize",resize);

intro.addEventListener("click",()=>{
    music.play().catch(()=>{});
    intro.style.opacity=0;
    setTimeout(()=>intro.remove(),1000);
    phaseStart=Date.now();
});

let particles=[],stars=[],rockets=[],fireworks=[];
let phase="heart";
let phaseStart=Date.now();
let countdown=3;
let nameText="ChouChou";
let heartBeat=0;
let wordIndex=0;

let words=[
"Mong r·∫±ng","nh·ªØng ng√†y nƒÉm m·ªõi",
"3 b·ªØa","4 m√πa","c·ªßa ch·ªã b√©",
"s·∫Ω","d·ªãu d√†ng","v√†","b√¨nh an"
];

/* ‚≠ê Stars (gi·∫£m c√≤n 120 cho m∆∞·ª£t) */
for(let i=0;i<120;i++){
    stars.push({
        x:Math.random()*innerWidth,
        y:Math.random()*innerHeight,
        size:Math.random()*2,
        alpha:Math.random()
    });
}

/* üíõ Heart */
function createHeart(){
    particles=[];
    const cx=innerWidth/2;
    const cy=innerHeight/2;
    heartBeat+=0.05;
    const scale=12+Math.sin(heartBeat)*1.5;

    for(let t=0;t<Math.PI*2;t+=0.03){
        let x=16*Math.pow(Math.sin(t),3);
        let y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        particles.push({
            x:cx+x*scale,
            y:cy-y*scale,
            tx:cx+x*scale,
            ty:cy-y*scale,
            size:3
        });
    }
}

/* üéá Firework */
function launchRocket(){
    rockets.push({
        x:Math.random()*innerWidth,
        y:innerHeight,
        targetY:Math.random()*innerHeight/2,
        speed:4+Math.random()*2
    });
}
function explodeFirework(x,y){
    for(let i=0;i<60;i++){
        fireworks.push({
            x,y,
            vx:(Math.random()-0.5)*6,
            vy:(Math.random()-0.5)*6,
            alpha:1
        });
    }
}

/* ‚ú® Text */
function textToParticles(text,size=100,fromSides=false){
    const temp=document.createElement("canvas");
    temp.width=innerWidth;
    temp.height=innerHeight;
    const tctx=temp.getContext("2d");

    tctx.fillStyle="white";
    tctx.font="bold "+size+"px Arial";
    tctx.textAlign="center";
    tctx.textBaseline="middle";

    if(text.includes("\n")){
        let lines=text.split("\n");
        lines.forEach((l,i)=>{
            tctx.fillText(l,innerWidth/2,innerHeight/2+i*size);
        });
    }else{
        tctx.fillText(text,innerWidth/2,innerHeight/2);
    }

    const data=tctx.getImageData(0,0,innerWidth,innerHeight).data;
    particles=[];
    for(let y=0;y<innerHeight;y+=8){
        for(let x=0;x<innerWidth;x+=8){
            let i=(y*innerWidth+x)*4;
            if(data[i+3]>150){
                let startX=Math.random()*innerWidth;
                let startY=Math.random()*innerHeight;

                if(fromSides){
                    let side=Math.floor(Math.random()*4);
                    if(side===0)startX=0;
                    if(side===1)startX=innerWidth;
                    if(side===2)startY=0;
                    if(side===3)startY=innerHeight;
                }

                particles.push({x:startX,y:startY,tx:x,ty:y,size:3});
            }
        }
    }
}

/* üí• Explode */
function explodeParticles(){
    particles.forEach(p=>{
        p.vx=(Math.random()-0.5)*10;
        p.vy=(Math.random()-0.5)*10;
    });
}

/* üé¨ Draw */
function draw(){
    ctx.clearRect(0,0,innerWidth,innerHeight);

    stars.forEach(s=>{
        ctx.fillStyle="rgba(255,255,255,"+s.alpha+")";
        ctx.fillRect(s.x,s.y,s.size,s.size);
    });

    if(phase==="heart") createHeart();

    rockets.forEach((r,i)=>{
        r.y-=r.speed;
        ctx.fillStyle="#FFD700";
        ctx.fillRect(r.x,r.y,3,8);
        if(r.y<=r.targetY){
            explodeFirework(r.x,r.y);
            rockets.splice(i,1);
        }
    });

    fireworks.forEach((f,i)=>{
        f.x+=f.vx;
        f.y+=f.vy;
        f.alpha-=0.02;
        ctx.globalAlpha=f.alpha;
        ctx.fillStyle="#FFD700";
        ctx.beginPath();
        ctx.arc(f.x,f.y,2,0,Math.PI*2);
        ctx.fill();
        ctx.globalAlpha=1;
        if(f.alpha<=0)fireworks.splice(i,1);
    });

    particles.forEach(p=>{
        if(p.tx!==undefined){
            p.x+=(p.tx-p.x)*0.07;
            p.y+=(p.ty-p.y)*0.07;
        }
        if(p.vx){
            p.x+=p.vx;
            p.y+=p.vy;
        }
        ctx.fillStyle="#FFD700";
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
    });

    timeline();
    requestAnimationFrame(draw);
}

/* ‚è≥ Timeline */
function timeline(){
    let elapsed=Date.now()-phaseStart;

    if(phase==="heart" && elapsed>3500){
        explodeParticles();
        phase="explode";
        phaseStart=Date.now();
    }

    if(phase==="explode" && elapsed>1000){
        phase="countdown";
        countdown=3;
        textToParticles("3",180);
        phaseStart=Date.now();
    }

    if(phase==="countdown" && elapsed>=1000){
        countdown--;
        phaseStart=Date.now();

        if(countdown>0){
            textToParticles(countdown.toString(),180);
        }else{
            setInterval(launchRocket,900);
            phase="words";
            phaseStart=Date.now();
        }
    }

    if(phase==="words" && elapsed>2500){
        if(wordIndex<words.length){
            textToParticles(words[wordIndex],70);
            wordIndex++;
            phaseStart=Date.now();
        }else{
            phase="full";
            textToParticles(
"Mong r·∫±ng nh·ªØng ng√†y nƒÉm m·ªõi 3 b·ªØa\n4 m√πa c·ªßa ch·ªã ƒë·ªÅu d·ªãu d√†ng v√† b√¨nh an",
45
            );
            phaseStart=Date.now();
        }
    }

    if(phase==="full" && elapsed>5000){
        phase="name";
        textToParticles(nameText,120,true);
        phaseStart=Date.now();
    }
}

createHeart();
draw();
</script>
</body>
</html>
