<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For ChouChou</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
    font-family:Arial, sans-serif;
}
canvas{display:block;}

/* ===== INTRO SCREEN ===== */
#intro{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:radial-gradient(circle at center,#000020,#000);
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:999;
    transition:opacity 1s ease;
}

.intro-content{
    text-align:center;
    color:#FFD700;
    animation: glow 2s infinite alternate;
}

.intro-content h1{
    font-size:24px;
    margin-bottom:10px;
}

.intro-content p{
    font-size:18px;
    opacity:0.8;
}

@keyframes glow{
    from{text-shadow:0 0 10px #FFD700;}
    to{text-shadow:0 0 25px #FFD700;}
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
    <div class="intro-content">
        <h1>âœ¨ Cháº¡m Ä‘á»ƒ báº¯t Ä‘áº§u nÄƒm má»›i âœ¨</h1>
        <p>For ChouChou ðŸ’›</p>
    </div>
</div>

<canvas id="canvas"></canvas>
<audio id="bgMusic" src="music.mp3" preload="auto"></audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const music = document.getElementById("bgMusic");
const intro = document.getElementById("intro");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener("resize",()=>{
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

/* ===== START AFTER TAP ===== */
intro.addEventListener("click", ()=>{
    music.play().catch(()=>{});
    intro.style.opacity="0";
    setTimeout(()=>{
        intro.style.display="none";
        phaseStart = Date.now();
    },1000);
});

/* ===== VARIABLES ===== */
let particles=[];
let rockets=[];
let fireworks=[];
let stars=[];
let phase="heart";
let phaseStart=Date.now();
let countdown=3;
let nameText="ChouChou";
let heartBeat=0;
let rocketInterval=null;

/* ===== STAR BACKGROUND ===== */
for(let i=0;i<300;i++){
    stars.push({
        x:Math.random()*canvas.width,
        y:Math.random()*canvas.height,
        size:Math.random()*2,
        alpha:Math.random()
    });
}

/* ===== HEART ===== */
function createHeart(){
    particles=[];
    const cx=canvas.width/2;
    const cy=canvas.height/2;

    heartBeat += 0.05;
    const scale = 14 + Math.sin(heartBeat)*2;

    for(let t=0;t<Math.PI*2;t+=0.015){
        let x=16*Math.pow(Math.sin(t),3);
        let y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        particles.push({
            x:cx+x*scale,
            y:cy-y*scale,
            tx:cx+x*scale,
            ty:cy-y*scale,
            size:4
        });
    }
}

/* ===== FIREWORK ===== */
function launchRocket(){
    rockets.push({
        x:Math.random()*canvas.width,
        y:canvas.height,
        targetY:Math.random()*canvas.height/2,
        speed:4+Math.random()*2
    });
}

function explodeFirework(x,y){
    let colors=["#FFD700","#FF4D4D","#4DA6FF","#FF66FF"];
    let color=colors[Math.floor(Math.random()*colors.length)];

    for(let i=0;i<100;i++){
        fireworks.push({
            x:x,
            y:y,
            vx:(Math.random()-0.5)*8,
            vy:(Math.random()-0.5)*8,
            alpha:1,
            color:color
        });
    }
}

/* ===== TEXT TO PARTICLES ===== */
function textToParticles(text,fontSize=100,fromSides=false){
    const temp=document.createElement("canvas");
    const tctx=temp.getContext("2d");
    temp.width=canvas.width;
    temp.height=canvas.height;

    tctx.fillStyle="white";
    tctx.font="bold "+fontSize+"px Arial";
    tctx.textAlign="center";
    tctx.textBaseline="middle";

    if(text.includes("\n")){
        let lines=text.split("\n");
        lines.forEach((line,i)=>{
            tctx.fillText(line,canvas.width/2,canvas.height/2+i*fontSize);
        });
    }else{
        tctx.fillText(text,canvas.width/2,canvas.height/2);
    }

    const data=tctx.getImageData(0,0,canvas.width,canvas.height).data;
    let newParticles=[];

    for(let y=0;y<canvas.height;y+=6){
        for(let x=0;x<canvas.width;x+=6){
            let i=(y*canvas.width+x)*4;
            if(data[i+3]>150){

                let startX=Math.random()*canvas.width;
                let startY=Math.random()*canvas.height;

                if(fromSides){
                    let side=Math.floor(Math.random()*4);
                    if(side===0){ startX=0; }
                    if(side===1){ startX=canvas.width; }
                    if(side===2){ startY=0; }
                    if(side===3){ startY=canvas.height; }
                }

                newParticles.push({
                    x:startX,
                    y:startY,
                    tx:x,
                    ty:y,
                    size:3
                });
            }
        }
    }
    particles=newParticles;
}

/* ===== EXPLODE ===== */
function explodeParticles(){
    particles.forEach(p=>{
        p.vx=(Math.random()-0.5)*12;
        p.vy=(Math.random()-0.5)*12;
    });
}

/* ===== DRAW LOOP ===== */
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    stars.forEach(s=>{
        ctx.fillStyle="rgba(255,255,255,"+s.alpha+")";
        ctx.fillRect(s.x,s.y,s.size,s.size);
    });

    if(phase==="heart"){
        createHeart();
    }

    rockets.forEach((r,i)=>{
        r.y-=r.speed;
        ctx.fillStyle="#FFD700";
        ctx.fillRect(r.x,r.y,3,10);
        if(r.y<=r.targetY){
            explodeFirework(r.x,r.y);
            rockets.splice(i,1);
        }
    });

    fireworks.forEach((f,i)=>{
        f.x+=f.vx;
        f.y+=f.vy;
        f.alpha-=0.02;
        ctx.globalAlpha=f.alpha;
        ctx.fillStyle=f.color;
        ctx.beginPath();
        ctx.arc(f.x,f.y,2,0,Math.PI*2);
        ctx.fill();
        ctx.globalAlpha=1;
        if(f.alpha<=0)fireworks.splice(i,1);
    });

    particles.forEach(p=>{
        if(p.tx!==undefined){
            p.x+=(p.tx-p.x)*0.07;
            p.y+=(p.ty-p.y)*0.07;
        }
        if(p.vx){
            p.x+=p.vx;
            p.y+=p.vy;
        }
        ctx.fillStyle="#FFD700";
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
    });

    timeline();
    requestAnimationFrame(draw);
}

/* ===== TIMELINE ===== */
let words=[
"Mong ráº±ng","nhá»¯ng ngÃ y nÄƒm má»›i",
"3 bá»¯a","4 mÃ¹a","cá»§a chá»‹ bÃ©","sáº½","dá»‹u dÃ ng","vÃ ","bÃ¬nh an"
];
let wordIndex=0;

function timeline(){
    let elapsed=Date.now()-phaseStart;

    if(phase==="heart" && elapsed>4000){
        explodeParticles();
        phase="explode";
        phaseStart=Date.now();
    }

    if(phase==="explode" && elapsed>1000){
        phase="countdown";
        countdown=4;
        textToParticles("3",200);
        phaseStart=Date.now();
    }

    if(phase==="countdown" && elapsed>=1500){
        countdown--;
        phaseStart=Date.now();

        if(countdown>0){
            textToParticles(countdown.toString(),200);
        }else{
            rocketInterval=setInterval(launchRocket,800);
            phase="words";
            phaseStart=Date.now();
        }
    }

    if(phase==="words" && elapsed>3000){
        if(wordIndex<words.length){
            textToParticles(words[wordIndex],90);
            wordIndex++;
            phaseStart=Date.now();
        }else{
            phase="full";
            textToParticles(
"Mong ráº±ng nhá»¯ng ngÃ y nÄƒm má»›i 3 bá»¯a\n4 mÃ¹a cá»§a chá»‹ Ä‘á»u dá»‹u dÃ ng vÃ  bÃ¬nh an",
60
            );
            phaseStart=Date.now();
        }
    }

    if(phase==="full" && elapsed>5500){
        phase="name";
        textToParticles(nameText,130,true);
        phaseStart=Date.now();
    }
}

createHeart();
draw();
</script>

</body>
</html>
