<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>For ChouChou ðŸ’›</title>

<style>
html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:black;
    font-family:Arial, sans-serif;
    touch-action:manipulation;
}
canvas{display:block;}
#intro{
    position:fixed;
    inset:0;
    background:radial-gradient(circle at center,#000020,#000);
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:999;
    transition:opacity 1s ease;
}
.intro-content{
    text-align:center;
    color:#FFD700;
    animation: glow 2s infinite alternate;
}
@keyframes glow{
    from{text-shadow:0 0 10px #FFD700;}
    to{text-shadow:0 0 25px #FFD700;}
}
</style>
</head>

<body>

<div id="intro">
    <div class="intro-content">
        <h2>âœ¨ Cháº¡m Ä‘á»ƒ báº¯t Ä‘áº§u âœ¨</h2>
        <p>(chá»‹ bÃ© xoay ngang mÃ n hÃ¬nh nha) ðŸ’›</p>
    </div>
</div>

<canvas id="canvas"></canvas>
<audio id="bgMusic" src="music.mp3" preload="auto"></audio>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const intro=document.getElementById("intro");
const music=document.getElementById("bgMusic");

function resizeCanvas(){
    const dpr=window.devicePixelRatio||1;
    canvas.width=window.innerWidth*dpr;
    canvas.height=window.innerHeight*dpr;
    canvas.style.width=window.innerWidth+"px";
    canvas.style.height=window.innerHeight+"px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
}
resizeCanvas();
window.addEventListener("resize",resizeCanvas);

intro.addEventListener("click",()=>{
    music.play().catch(()=>{});
    intro.style.opacity="0";
    setTimeout(()=>{
        intro.style.display="none";
        phaseStart=Date.now();
    },1000);
});

let particles=[], rockets=[], fireworks=[], stars=[];
let phase="heart";
let phaseStart=Date.now();
let countdown=4;
let wordIndex=0;
let heartBeat=0;
let nameText="ChouChou";
let showMorse=false;

/* STARS */
for(let i=0;i<150;i++){
    stars.push({
        x:Math.random()*window.innerWidth,
        y:Math.random()*window.innerHeight,
        size:Math.random()*2,
        alpha:Math.random()
    });
}

/* HEART */
function createHeart(){
    particles=[];
    const cx=window.innerWidth/2;
    const cy=window.innerHeight/2;
    heartBeat+=0.05;
    const scale=14+Math.sin(heartBeat)*2;

    for(let t=0;t<Math.PI*2;t+=0.02){
        let x=16*Math.pow(Math.sin(t),3);
        let y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        particles.push({
            x:cx+x*scale,
            y:cy-y*scale,
            size:3
        });
    }
}

/* ROCKET */
function launchRocket(){
    rockets.push({
        x:Math.random()*window.innerWidth,
        y:window.innerHeight,
        targetY:Math.random()*window.innerHeight/2,
        speed:4+Math.random()*2
    });
}

function explodeFirework(x,y){
    let colors=["#FFD700","#FF4D4D","#4DA6FF","#FF66FF"];
    let color=colors[Math.floor(Math.random()*colors.length)];
    for(let i=0;i<60;i++){
        fireworks.push({
            x,y,
            vx:(Math.random()-0.5)*8,
            vy:(Math.random()-0.5)*8,
            alpha:1,
            color
        });
    }
}

/* TEXT PARTICLES */
function textToParticles(text,fontSize=100,fromSides=false){
    const temp=document.createElement("canvas");
    const tctx=temp.getContext("2d");
    temp.width=window.innerWidth;
    temp.height=window.innerHeight;

    tctx.fillStyle="white";
    tctx.font="bold "+fontSize+"px Arial";
    tctx.textAlign="center";
    tctx.textBaseline="middle";
    tctx.fillText(text,window.innerWidth/2,window.innerHeight/2);

    const data=tctx.getImageData(0,0,temp.width,temp.height).data;
    let newParticles=[];

    for(let y=0;y<temp.height;y+=6){
        for(let x=0;x<temp.width;x+=6){
            let i=(y*temp.width+x)*4;
            if(data[i+3]>150){

                let startX=Math.random()*window.innerWidth;
                let startY=Math.random()*window.innerHeight;

                if(fromSides){
                    let side=Math.floor(Math.random()*4);
                    if(side===0)startX=0;
                    if(side===1)startX=window.innerWidth;
                    if(side===2)startY=0;
                    if(side===3)startY=window.innerHeight;
                }

                newParticles.push({
                    x:startX,
                    y:startY,
                    tx:x,
                    ty:y,
                    size:3.5
                });
            }
        }
    }
    particles=newParticles;
}

/* DRAW */
function draw(){
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    stars.forEach(s=>{
        ctx.fillStyle="rgba(255,255,255,"+s.alpha+")";
        ctx.fillRect(s.x,s.y,s.size,s.size);
    });

    if(phase==="heart") createHeart();

    rockets.forEach((r,i)=>{
        r.y-=r.speed;
        ctx.fillStyle="#FFD700";
        ctx.fillRect(r.x,r.y,3,10);
        if(r.y<=r.targetY){
            explodeFirework(r.x,r.y);
            rockets.splice(i,1);
        }
    });

    fireworks.forEach((f,i)=>{
        f.x+=f.vx;
        f.y+=f.vy;
        f.alpha-=0.02;
        ctx.globalAlpha=f.alpha;
        ctx.fillStyle=f.color;
        ctx.beginPath();
        ctx.arc(f.x,f.y,2,0,Math.PI*2);
        ctx.fill();
        ctx.globalAlpha=1;
        if(f.alpha<=0)fireworks.splice(i,1);
    });

    particles.forEach(p=>{
        if(p.tx!==undefined){
            p.x+=(p.tx-p.x)*0.07;
            p.y+=(p.ty-p.y)*0.07;
        }
        ctx.shadowBlur=15;
        ctx.shadowColor="#FFD700";
        ctx.fillStyle="#FFD700";
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
        ctx.shadowBlur=0;
    });

    /* MORSE TEXT DRAW */
    if(showMorse){
        ctx.fillStyle="#FFD700";
        ctx.font="bold 36px Courier New";
        ctx.textAlign="center";
        ctx.textBaseline="middle";

        let lines=["..",
                   ".-.. --- ...- .",
                   "-.-- --- ..-"];

        let lineHeight=45;
        let startY=window.innerHeight/2-(lines.length*lineHeight)/2;

        lines.forEach((line,i)=>{
            ctx.fillText(line,window.innerWidth/2,startY+i*lineHeight);
        });
    }

    timeline();
    requestAnimationFrame(draw);
}

/* TIMELINE */
let words=["Mong ráº±ng","nhá»¯ng ngÃ y","nÄƒm má»›i",
"3 bá»¯a","4 mÃ¹a","cá»§a chá»‹ bÃ©",
"sáº½","dá»‹u dÃ ng","vÃ ","bÃ¬nh an"];

function timeline(){
    let elapsed=Date.now()-phaseStart;

    if(phase==="heart" && elapsed>4000){
        phase="countdown";
        textToParticles("4",200);
        phaseStart=Date.now();
    }

    if(phase==="countdown" && elapsed>=1000){
        countdown--;
        phaseStart=Date.now();
        if(countdown>0){
            textToParticles(countdown.toString(),200);
        }else{
            phase="fireworks";
            setInterval(launchRocket,800);
        }
    }

    if(phase==="fireworks" && elapsed>2000){
        phase="words";
        phaseStart=Date.now();
    }

    if(phase==="words" && elapsed>2500){
        if(wordIndex<words.length){
            textToParticles(words[wordIndex],90);
            wordIndex++;
            phaseStart=Date.now();
        }else{
            phase="morse";
            particles=[];
            showMorse=true;
            phaseStart=Date.now();
        }
    }

    if(phase==="morse" && elapsed>6000){
        showMorse=false;
        phase="name";
        textToParticles(nameText,120,true);
        phaseStart=Date.now();
    }
}

draw();
</script>
</body>
</html>
